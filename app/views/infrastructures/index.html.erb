<%- model_class = Infrastructure -%>
<div class="page-header">
  <h1><%=t 'infrastructures.infrastructure' %></h1>
  <%= breadcrumbs(@selected_client, @selected_project, nil) if current_user.master? %>
  <%= link_to t('infrastructures.return_to_projects'), projects_path, {class: "btn btn-small btn-link"} unless current_user.master? %>
</div>


<!-- component template -->
<script type="text/x-template" id="grid-template">
  <table class="table table-hover">
    <tr>
      <th v-repeat="key: columns"
        v-on="click:sortBy(key)"
        v-class="active: sortKey === key">
        <text v-html="key | wrap"></text>
          <span v-if="key !== 'id'" class="glyphicon pull-right" v-class="reversed[key] ? 'glyphicon-chevron-down' : 'glyphicon-chevron-up'"></span>
      </th>
      </tr>
    </thead>
    <tbody>
      <tr class="infrastructure-row" v-repeat="
        entry: data
        | filterBy filterKey
        | orderBy sortKey reversed[sortKey]
        | paginate">
        <td v-repeat="key: columns">
          <text id="{{key}}" v-html="entry[key] | listen key "></text>
        </td>
      </tr>
    </tbody>
  </table>
<nav v-if="data.length >= 10">
  <ul class="pager">
    <li class="{{isStartPage ? 'disabled' : '' }}"><a v-on="click: showPrev()" ><span aria-hidden="true">&larr; <%= t 'monitoring.btn.prev' %></a></li>
<label><%= t 'monitoring.msg.page' %>: &nbsp </label><strong v-html="pageNumber + 1"></strong> <%= t 'monitoring.msg.of' %>&nbsp<span v-html="data.length / pages  | roundup"></span>
    <li class="{{isEndPage ? 'disabled' : '' }}"><a v-on="click: showNext()" v-attr="disabled: !isEndPage"></span><%= t 'monitoring.btn.next' %> <span aria-hidden="true">&rarr;</a></li>
</ul>

          </nav>
</script>

<!-- demo root element -->
<div-loader v-if="loading"></div-loader>
<div id="demo">
  <div class="input-group">
    <form id="search">
      <input type="text" name="query" v-model="searchQuery" class="form-control" placeholder="<%= t 'infrastructures.search' %>">
    </form>
  </div>
  <hr>
  <demo-grid
    data="{{gridData}}"
    columns="{{gridColumns}}"
    filter-key="{{searchQuery}}">
  </demo-grid>
</div>

<table class="table table-hover hidden">
  <!-- <thead>
    <tr>
      <th><%= t 'infrastructures.stackname' %></th>
      <th><%= t 'infrastructures.region' %></th>
      <th><%= t 'infrastructures.keypair' %></th>
      <th><%= t 'common.actions' %></th>
    </tr>
  </thead> -->
  <tbody>
    <% @infrastructures.each do |infra| %>
      <!-- <tr class="infrastructure-row">
        <td><%= infra.stack_name %></td>
        <td><%= infra.region %></td>
        <td><%= infra.keypairname || t('infrastructures.msg.no_keypair') %></td>
        <td> -->
        <td>
          <%= button_show_infra(infra) %>

          <%= button_serverspecs(infra.id) %>

          <%= button_edit_infra(infra) %>
          <%= button_detach_stack(infra) %>
          <%= button_delete_stack(infra) %>
        </td>
      </tr>
    <% end %>
  </tbody>
</table>

<!-- <div class="text-center">
  <%= paginate(@infrastructures) %>
</div> -->

<%= button_add_infra(@selected_project) %>

<div class="page-header"></div>

<%= render 'show' %>
